'use strict';
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    }
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var mersenne_twister_1 = require("../mersenne-twister");
var inormal_rng_1 = require("./inormal-rng");
var exp = Math.exp, log = Math.log, sqrt = Math.sqrt, fmax2 = Math.max, fmin2 = Math.min, fabs = Math.abs;
var A = 2.216035867166471;
var C1 = 0.398942280401433;
var C2 = 0.180025191068563;
var KindermanRamage = (function (_super) {
    __extends(KindermanRamage, _super);
    function KindermanRamage(_rng) {
        if (_rng === void 0) { _rng = new mersenne_twister_1.MersenneTwister(0); }
        return _super.call(this, _rng) || this;
    }
    KindermanRamage.prototype.internal_norm_rand = function () {
        var u1;
        var u2;
        var u3;
        var tt;
        var g = function (x) { return C1 * exp(-x * x / 2.0) - C2 * (A - x); };
        u1 = this.rng.unif_rand();
        if (u1 < 0.884070402298758) {
            u2 = this.rng.unif_rand();
            return A * (1.13113163544418 * u1 + u2 - 1);
        }
        if (u1 >= 0.973310954173898) {
            for (;;) {
                u2 = this.rng.unif_rand();
                u3 = this.rng.unif_rand();
                tt = A * A - 2 * log(u3);
                if (u2 * u2 < A * A / tt)
                    return u1 < 0.986655477086949 ? sqrt(tt) : -sqrt(tt);
            }
        }
        if (u1 >= 0.958720824790463) {
            for (;;) {
                u2 = this.rng.unif_rand();
                u3 = this.rng.unif_rand();
                tt = A - 0.63083480192196 * fmin2(u2, u3);
                if (fmax2(u2, u3) <= 0.755591531667601)
                    return u2 < u3 ? tt : -tt;
                if (0.034240503750111 * fabs(u2 - u3) <= g(tt))
                    return u2 < u3 ? tt : -tt;
            }
        }
        if (u1 >= 0.911312780288703) {
            for (;;) {
                u2 = this.rng.unif_rand();
                u3 = this.rng.unif_rand();
                tt = 0.479727404222441 + 1.10547366102207 * fmin2(u2, u3);
                if (fmax2(u2, u3) <= 0.87283497667179)
                    return u2 < u3 ? tt : -tt;
                if (0.049264496373128 * fabs(u2 - u3) <= g(tt))
                    return u2 < u3 ? tt : -tt;
            }
        }
        for (;;) {
            u2 = this.rng.unif_rand();
            u3 = this.rng.unif_rand();
            tt = 0.479727404222441 - 0.59550713801594 * fmin2(u2, u3);
            if (tt < 0)
                continue;
            if (fmax2(u2, u3) <= 0.805577924423817)
                return u2 < u3 ? tt : -tt;
            if (0.053377549506886 * fabs(u2 - u3) <= g(tt))
                return u2 < u3 ? tt : -tt;
        }
    };
    return KindermanRamage;
}(inormal_rng_1.IRNGNormal));
exports.KindermanRamage = KindermanRamage;
//# sourceMappingURL=kinderman-ramage.js.map