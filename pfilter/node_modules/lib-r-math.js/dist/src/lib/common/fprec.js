"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _general_1 = require("../common/_general");
var floor = Math.floor, fabs = Math.abs, log10 = Math.log10, round = Math.round, R_rint = Math.round;
var R_FINITE = Number.isFinite, ISNAN = Number.isNaN;
var MAX_DIGITS = 22;
function fprec(x, digits) {
    var l10;
    var pow10;
    var sgn;
    var p10;
    var P10;
    var e10;
    var e2;
    var do_round;
    var dig;
    var max10e = Math.log10(Number.MAX_VALUE);
    if (ISNAN(x) || ISNAN(digits))
        return x + digits;
    if (!R_FINITE(x))
        return x;
    if (!R_FINITE(digits)) {
        if (digits > 0.0)
            return x;
        else
            digits = 1.0;
    }
    if (x === 0)
        return x;
    dig = round(digits);
    if (dig > MAX_DIGITS) {
        return x;
    }
    else if (dig < 1)
        dig = 1;
    sgn = 1.0;
    if (x < 0.0) {
        sgn = -sgn;
        x = -x;
    }
    l10 = log10(x);
    e10 = (dig - 1 - floor(l10));
    if (fabs(l10) < max10e - 2) {
        p10 = 1.0;
        if (e10 > max10e) {
            p10 = _general_1.R_pow_di(10., e10 - max10e);
            e10 = max10e;
        }
        if (e10 > 0) {
            pow10 = _general_1.R_pow_di(10., e10);
            return (sgn * (R_rint((x * pow10) * p10) / pow10) / p10);
        }
        else {
            pow10 = _general_1.R_pow_di(10., -e10);
            return (sgn * (R_rint((x / pow10)) * pow10));
        }
    }
    else {
        do_round = max10e - l10 >= _general_1.R_pow_di(10., -dig);
        e2 = dig + ((e10 > 0) ? 1 : -1) * MAX_DIGITS;
        p10 = _general_1.R_pow_di(10., e2);
        x *= p10;
        P10 = _general_1.R_pow_di(10., e10 - e2);
        x *= P10;
        if (do_round)
            x += 0.5;
        x = floor(x) / p10;
        return (sgn * x / P10);
    }
}
exports.fprec = fprec;
//# sourceMappingURL=fprec.js.map